# 古代汉语方所表达查询系统

秦宇航 北京大学中文系 hezonglianheng@stu.pku.edu.cn
## 目录

- [古代汉语方所表达查询系统](#古代汉语方所表达查询系统)
  - [目录](#目录)
  - [简介](#简介)
  - [空间语义标注系统](#空间语义标注系统)
    - [空间表达定义](#空间表达定义)
    - [空间表达语义角色](#空间表达语义角色)
    - [空间表达语义类型](#空间表达语义类型)
  - [主要功能](#主要功能)
    - [单语查询](#单语查询)
    - [模式查询](#模式查询)
    - [语料统计](#语料统计)
    - [使用说明](#使用说明)
  - [使用方法](#使用方法)
    - [数据库添加方法](#数据库添加方法)
    - [服务器启动方法](#服务器启动方法)
  - [文件说明](#文件说明)
    - [文件](#文件)
    - [文件夹](#文件夹)

## 简介

本系统是古代汉语方所表达查询系统，目前实现了如下功能：
1. 展示已有的古代汉语方位表达研究成果
2. 提供简单的查询接口，供后续研究使用
3. 展示对研究结果的统计分析

## 空间语义标注系统

本系统的查询、展示基于我们定义的一套空间语义标注系统。下面对该系统做简要介绍。

### 空间表达定义

空间表达包含两种类型的句子：
1. 描述物体空间位置的句子；
2. 描述物体空间移动的句子。

例如：
(1) 遂寘姜氏于城颍，而誓之曰：不及黄泉，无相见也。  
(2)	夏，夫人姜氏如齐。  
上例中，(1)描述了物体“姜氏”位于“城颍”的空间位置；(2)描述了物体“夫人姜氏”终点为“齐”的空间移动。(1)(2)都是本系统中的“空间表达”。  

### 空间表达语义角色
本系统将空间表达语义角色分为射体（trajectory）、界标（landmark）、事件（event）、介词（preposition）、方位（locative）5种，其定义如下表所示。“示例”一栏中的加粗文本为空间表达中对应的语义角色。  
| 种类 	|                                   意义                                   	|                   示例                   	|
|:----:	|:------------------------------------------------------------------------:	|:----------------------------------------:	|
| 射体 	|                           被描述空间信息的物体                           	|     秋八月己巳，**诸侯**同盟于重丘。     	|
| 界标 	|                    作为参照说明其他物体空间信息的物体                    	|       侨如以夫人妇姜氏至自**齐**。       	|
| 事件 	|    与物体空间信息相关的表示事件的谓词，表示物体处于某位置或运动的状态    	|          去疾**奔**齐，齐出也。          	|
| 介词 	|                               引介界标的词                               	|        夏五月，郑伯克段**于**鄢。        	|
| 方位 	|                       和界标结合，指示界标具体位置                       	| 郑人击简子中肩，毙于车**中**，获其蠭旗。 	|

### 空间表达语义类型
本系统将空间表达语义类型分为处所、起点、终点、朝向、方向、路径、部件处所7种，定义如下标所示。
|   种类   	|                                意义                                	|              示例              	|                      解释                      	|
|:--------:	|:------------------------------------------------------------------:	|:------------------------------:	|:----------------------------------------------:	|
|   处所   	|                      界标是静态物体所处的位置                      	|  秋八月己巳，诸侯同盟于重丘。  	|         “诸侯”同盟时所处的位置是“重丘”         	|
|   起点   	|                   界标是动态物体运动开始时的位置                   	|        夫人姜氏至自齐。        	|            “姜氏”来到某处的起点是“齐”          	|
|   终点   	|                   界标是动态物体运动结束时的位置                   	|       夏，夫人姜氏如齐。       	|             “姜氏”移动的终点是“齐”             	|
|   朝向   	|                      界标是静态物体朝向的方向                      	|        秦伯……乡师而哭。        	|   “秦伯”是有面朝方向的，此空间场景下面向“师”   	|
|   方向   	|                      界标是动态物体运动的方向                      	|       诸侯之师还郑而南。       	|   本句表示“诸侯之师”向南运动，指明运动的方向   	|
|   路径   	|                 界标是动态物体运动经过的位置或路线                 	|    我师次于督扬，不敢过郑。    	|          本句表示“我师”移动时经过“郑”          	|
| 部件处所 	| 界标是静态物体所处的位置，与处所不同的是，此时射体是界标的组成部分 	| 冬，齐人、宋人、陈人伐我西鄙。 	| “鄙”处于“我”（我国）西边，且“鄙”是“我”的一部分 	|
## 主要功能

### 单语查询
单语查询的主要功能为：根据用户输入的语言片段，查找数据库中某个空间语义角色与该片段一致或含有该片段的空间信息。可用的输入信息如下表所示：  
| 输入   | 含义                                                       |
|:----:|:--------------------------------------------------------:|
| 文本信息 | 需要查询的文本，为任意汉字字符串                                         |
| 空间角色 | 查询结果中，与该片段一致或含有该片段的空间语义角色。为下拉选项，有“全部”及5种空间语义角色类型。默认“全部”  |
| 空间语义 | 查询结果的空间语义类型。为下拉选项，有“全部”及7种空间语义类型。默认“全部”                  |
| 查询模式 | 下拉选项，有“精确”“模糊”2个选项。默认“精确”                                |

查询后，每页展示30个结果，查询词会高亮展示，页面左上显示查询具体参数、具体命中数量及当前查看的命中的编号范围。  
用户可以点击语料文本右侧的“详情”链接了解单条查询结果的详细信息。  
“详情”链接单击后，即在新页面生成该语料的详细信息，包括语料标题、副标题、文本内容、空间信息各元素（参见[空间表达语义角色](#空间表达语义角色)）以及空间信息的语义（参见[空间表达语义类型](#空间表达语义类型)）。

### 模式查询
模式查询支持用户按照预定义的一套形式语言，根据方位信息的语序查找特定语料。目前定义的模式语言的扩展巴科斯-瑙尔范式（[Extended Backus-Naur Form](https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E5%B7%B4%E7%A7%91%E6%96%AF%E8%8C%83%E5%BC%8F)）如下所示。  
```ebnf
Exp = Unit "+" Unit {"+" Unit} ;
Unit = Role ["(" Word ")"] ;
Role = "tr" | "lm" | "ev" | "pr" | "lo" ; (*Role分别表示射体, 界标, 事件, 介词和方位*) 
Word = … ; (*Word为任意汉字字符串*)
```
其中，`Role`指定需要查询的空间语义角色，`Word`可以指定需要查询的空间语义角色对应的词语（默认采用[单语查询](#单语查询)的模糊查询）。  
合法的查询表达式示例：
1. `tr+ev+lm`，用于查询语序为“射体+事件+界标”的空间表达
2. `tr+ev(如)+lm`，用于查询语序为“射体+事件+界标”，且事件包含“如”的空间表达

此模式下，[单语查询](#单语查询)的参数“空间语义”和“查询模式”仍然可用。不同的是：
1. “查询模式”为精确的场合，要求查询的空间表达的句式与表达式完全匹配；
2. “查询模式”为模糊的场合，要求查询的空间表达的句式中指定角色的语序与表达式匹配。

如下述例句：
(3) 天王~tr~居~ev~于~pr~狄泉~lm~。  
(4) 秋，郑伯~tr~因栎人杀檀伯，而遂居~ev~栎~lm~。  
对于表达式`tr+ev(居)+lm`，若为精确模式，则只能匹配(4)；若为模糊模式，则可以匹配上述2个例句。

### 语料统计
语料统计的主要功能为展示对当前语料按照一定标准进行统计分析的结果。目前展现的结果如下表所示。
| 统计项目 | 统计内容                                     |
|:----:|:----------------------------------------:|
| 语义统计 | 统计语料库中各空间表达的语义类型和数量           |
| 动词统计 | 统计不同空间语义的空间表达中动词的类型和数量。空间语义的取值见[空间表达语义类型](#空间表达语义类型)   |
| 介词统计 | 统计不同空间语义的空间表达中介词的类型和数量。空间语义的取值见[空间表达语义类型](#空间表达语义类型)   |
| 模式统计 | 统计不同空间语义的空间表达中模式的类型和数量。空间语义的取值见[空间表达语义类型](#空间表达语义类型)   |

### 使用说明
该功能显示的是本文档展示的基础的系统使用指南，与前文内容相同。

## 使用方法

### 数据库添加方法
1. 根据本仓库中的`requirements.txt`配置环境（Python3.12）.在命令行中运行命令`pip install -r requirements.txt`.
2. 将标注好的数据放入`corpus\json_corpus\ancient.json`（语料的格式参考该文件内容）.
3. 启动`py extract_ancient.py`.
4. 启动`py update_ancient_data.py -a -r`.
5. 数据库更新完成.

### 服务器启动方法
1. 根据本仓库中的`requirements.txt`配置环境（Python3.12）.
2. 在命令行中使用`cd`命令移动路径到本文件所在目录下.
3. 在保证环境激活（特别是虚拟环境）的前提下，在命令行中输入命令`py manage.py runserver [port]`。端口port可以自行指定，默认为8000.
4. 在浏览器中输入`localhost:[port]`（端口port在3中已经指定好），启动程序.

## 文件说明
本文件所在的目录下包含以下内容：

### 文件
1. `config.py`：运行配置脚本。
2. `extract_ancient.py`：用于将标注好的数据添加到数据库的脚本。
3. `update_ancient_data.py`：用于更新数据库的脚本。
4. `manage.py`：用于启动服务器的脚本。
5. `readme.md`：本文件，为使用说明
6. `db.sqlite3`：数据库文件。

### 文件夹
1. `corpus`文件夹：包含语料库相关的文件。
    - `json_corpus`文件夹：包含标注好的数据文件，其中`ancient.json`是语料的格式参考文件。
2. `homepage`：主页功能，为Django应用
3. `spatialquery`：单语查询功能，为Django应用
4. `patternquery`：模式查询功能，为Django应用
5. `corpus_stat`：语料统计功能，为Django应用